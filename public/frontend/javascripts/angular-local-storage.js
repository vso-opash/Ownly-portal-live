!function(){"use strict";var e=angular.isDefined,t=angular.isUndefined,o=angular.isNumber,r=angular.isObject,n=angular.isArray,a=angular.extend,i=angular.toJson;angular.module("LocalStorageModule",[]).provider("localStorageService",function(){this.prefix="ls",this.storageType="localStorage",this.cookie={expiry:30,path:"/"},this.defaultToCookie=!0,this.notify={setItem:!0,removeItem:!1},this.setPrefix=function(e){return this.prefix=e,this},this.setStorageType=function(e){return this.storageType=e,this},this.setDefaultToCookie=function(e){return this.defaultToCookie=!!e,this},this.setStorageCookie=function(e,t){return this.cookie.expiry=e,this.cookie.path=t,this},this.setStorageCookieDomain=function(e){return this.cookie.domain=e,this},this.setNotify=function(e,t){return this.notify={setItem:e,removeItem:t},this},this.$get=["$rootScope","$window","$document","$parse","$timeout",function(s,u,c,l,g){function f(e){if(e||(e=u.event),p.setItem&&k(e.key)){var t=v(e.key);g(function(){s.$broadcast("LocalStorageModule.notification.changed",{key:t,newvalue:e.newValue,storageType:h.storageType})})}}var d,h=this,m=h.prefix,T=h.cookie,p=h.notify,S=h.storageType;c?c[0]&&(c=c[0]):c=document,"."!==m.substr(-1)&&(m=m?m+".":"");var y=function(e){return m+e},v=function(e){return e.replace(new RegExp("^"+m,"g"),"")},k=function(e){return 0===e.indexOf(m)},O=function(){try{var e=S in u&&null!==u[S],t=y("__"+Math.round(1e7*Math.random()));return e&&(d=u[S],d.setItem(t,""),d.removeItem(t)),e}catch(o){return h.defaultToCookie&&(S="cookie"),s.$broadcast("LocalStorageModule.notification.error",o.message),!1}},b=O(),L=function(e,o,r){if(P(r),o=t(o)?null:i(o),!b&&h.defaultToCookie||"cookie"===h.storageType)return b||s.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),p.setItem&&s.$broadcast("LocalStorageModule.notification.setitem",{key:e,newvalue:o,storageType:"cookie"}),_(e,o);try{d&&d.setItem(y(e),o),p.setItem&&s.$broadcast("LocalStorageModule.notification.setitem",{key:e,newvalue:o,storageType:h.storageType})}catch(n){return s.$broadcast("LocalStorageModule.notification.error",n.message),_(e,o)}return!0},$=function(e,t){if(P(t),!b&&h.defaultToCookie||"cookie"===h.storageType)return b||s.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),R(e);var o=d?d.getItem(y(e)):null;if(!o||"null"===o)return null;try{return JSON.parse(o)}catch(r){return o}},M=function(){var e=0;arguments.length>=1&&("localStorage"===arguments[arguments.length-1]||"sessionStorage"===arguments[arguments.length-1])&&(e=1,P(arguments[arguments.length-1]));var t,o;for(t=0;t<arguments.length-e;t++)if(o=arguments[t],!b&&h.defaultToCookie||"cookie"===h.storageType)b||s.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),p.removeItem&&s.$broadcast("LocalStorageModule.notification.removeitem",{key:o,storageType:"cookie"}),w(o);else try{d.removeItem(y(o)),p.removeItem&&s.$broadcast("LocalStorageModule.notification.removeitem",{key:o,storageType:h.storageType})}catch(r){s.$broadcast("LocalStorageModule.notification.error",r.message),w(o)}},E=function(e){if(P(e),!b)return s.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),[];var t=m.length,o=[];for(var r in d)if(r.substr(0,t)===m)try{o.push(r.substr(t))}catch(n){return s.$broadcast("LocalStorageModule.notification.error",n.Description),[]}return o},x=function(e,t){P(t);var o=m?new RegExp("^"+m):new RegExp,r=e?new RegExp(e):new RegExp;if(!b&&h.defaultToCookie||"cookie"===h.storageType)return b||s.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),I();if(!b&&!h.defaultToCookie)return!1;var n=m.length;for(var a in d)if(o.test(a)&&r.test(a.substr(n)))try{M(a.substr(n))}catch(i){return s.$broadcast("LocalStorageModule.notification.error",i.message),I()}return!0},C=function(){try{return u.navigator.cookieEnabled||"cookie"in c&&(c.cookie.length>0||(c.cookie="test").indexOf.call(c.cookie,"test")>-1)}catch(e){return s.$broadcast("LocalStorageModule.notification.error",e.message),!1}}(),_=function(e,a,u){if(t(a))return!1;if((n(a)||r(a))&&(a=i(a)),!C)return s.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var l="",g=new Date,f="";if(null===a?(g.setTime(g.getTime()+-864e5),l="; expires="+g.toGMTString(),a=""):o(u)&&0!==u?(g.setTime(g.getTime()+24*u*60*60*1e3),l="; expires="+g.toGMTString()):0!==T.expiry&&(g.setTime(g.getTime()+24*T.expiry*60*60*1e3),l="; expires="+g.toGMTString()),e){var d="; path="+T.path;T.domain&&(f="; domain="+T.domain),c.cookie=y(e)+"="+encodeURIComponent(a)+l+d+f}}catch(h){return s.$broadcast("LocalStorageModule.notification.error",h.message),!1}return!0},R=function(e){if(!C)return s.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var t=c.cookie&&c.cookie.split(";")||[],o=0;o<t.length;o++){for(var r=t[o];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(y(e)+"=")){var n=decodeURIComponent(r.substring(m.length+e.length+1,r.length));try{return JSON.parse(n)}catch(a){return n}}}return null},w=function(e){_(e,null)},I=function(){for(var e=null,t=m.length,o=c.cookie.split(";"),r=0;r<o.length;r++){for(e=o[r];" "===e.charAt(0);)e=e.substring(1,e.length);var n=e.substring(t,e.indexOf("="));w(n)}},A=function(){return S},P=function(e){return e&&S!==e&&(S=e,b=O()),b},D=function(t,o,n,i,s){i=i||o;var u=$(i,s);return null===u&&e(n)?u=n:r(u)&&r(n)&&(u=a(u,n)),l(o).assign(t,u),t.$watch(o,function(e){L(i,e,s)},r(t[o]))};b&&(u.addEventListener?u.addEventListener("storage",f,!1):u.attachEvent&&u.attachEvent("onstorage",f));var N=function(e){P(e);for(var t=0,o=u[S],r=0;r<o.length;r++)0===o.key(r).indexOf(m)&&t++;return t};return{isSupported:b,getStorageType:A,setStorageType:P,set:L,add:L,get:$,keys:E,remove:M,clearAll:x,bind:D,deriveKey:y,underiveKey:v,length:N,defaultToCookie:this.defaultToCookie,cookie:{isSupported:C,set:_,add:_,get:R,remove:w,clearAll:I}}}]})}();